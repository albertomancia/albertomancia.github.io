---
layout: post
title:  "Mosaic"
date:   2023-03-20 15:29:27 -0700
categories: projects
permalink: /mosaic/
---

<p align="center">
    <img src="/assets/mosaic/2.png">
    <img src="/assets/mosaic/1.png">
</p>

This is one of my rare software-only projects. The published form is actually an [Instagram filter](https://www.instagram.com/ar/804390247877532) you can try for yourself!

Most of my programs can't be experienced this way; to make a stable, fast live video effect that can run on any smartphone you need to use shader code. It's difficult but rewarding to learn — you have to "invert" your point of view from an omniscient CPU to an anonymous, lost GPU thread that can only poke at its own surroundings. The most basic shapes and patterns are made in a completely different way than you would make them with a tool like Processing.

## The Challenge

I wanted to challenge myself by creating an impressionistic, painterly style. This is very easy to do using traditional CPU code — I even did it in [MATLAB](/matlab-painting/)! It's a major challenge in shader code for the same reason it's so easy everywhere else — Impressionism lends itself to stochastic processes, procedural layering of brushstrokes to gradually build up an image. You can't do that with real-time graphics, so you have to fake it.

As this project stands, it looks like a mosaic of colored tiles. I can't think of a painter that painted like this, and it still feels very "content-unaware". The one way in which it is content-aware is the interesting and difficult part of this project.

## Voronoi

[The Book of Shaders](thebookofshaders.com) has a great page on cellular noise, and drawing large Voronoi diagrams in GLSL. Instead of evaluating all the points, which becomes computationally expensive very quickly, their code subdivides the domain into a grid and only evaluates within the nine grid squares surrounding each texture coordinate.

What it's evaluating are the points that each square generates. While this pattern looks fairly random, if you look closely you can see that each grid square has exactly one point making an elliptical orbit around its center: 

<div class="video-mask" style="max-width: 90%; margin-left: 5%;">
    <video src="/assets/mosaic/1.mp4" autoplay loop muted></video>
</div>

It's relatively easy to make a colored Voronoi diagram from here: just sample the camera input at each point, then paint its cell that color. This looks kind of cool, but I think we can do something cooler. I want to depopulate areas of low detail so they have bigger cells. This feels closer to something a painter would do.

## Awareness

A detail map is easy enough to make with edge detection kernels. I might use Difference of Gaussians later, but a simple blurred edge map works just fine. 

## 